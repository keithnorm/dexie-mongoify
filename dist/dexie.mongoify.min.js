!function(n,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("Dexie"));else if("function"==typeof define&&define.amd)define(["Dexie"],e);else{var t=e("object"==typeof exports?require("Dexie"):n.Dexie);for(var r in t)("object"==typeof exports?exports:n)[r]=t[r]}}(this,function(n){return function(n){function e(r){if(t[r])return t[r].exports;var u=t[r]={exports:{},id:r,loaded:!1};return n[r].call(u.exports,u,u.exports,e),u.loaded=!0,u.exports}var t={};return e.m=n,e.c=t,e.p="",e(0)}([function(n,e,t){var r=t(12),u=t(5),o=t(4),i=t(2),c=t(11),f=t(7),a=t(8),s=t(9),p=t(6),l=t(10),d=t(1),y={$eq:function(n,e){return function(t){return d(t,n)&&t[n]===e}},$gt:function(n,e){return function(t){return d(t,n)&&t[n]>e}},$gte:function(n,e){return function(t){return d(t,n)&&t[n]>=e}},$lt:function(n,e){return function(t){return d(t,n)&&t[n]<e}},$lte:function(n,e){return function(t){return d(t,n)&&t[n]<=e}},$ne:function(n,e){return function(t){return d(t,n)&&t[n]!==e}},$in:function(n,e){return function(t){return d(t,n)&&e.indexOf(t[n])>-1}},$nin:function(n,e){return function(t){return d(t,n)&&e.indexOf(t[n])===-1}},$exists:function(n,e){return function(t){return d(t,n)===e}},$all:function(n,e){return function(t){return d(t,n)&&e.every(function(e){return t[n].indexOf(e)>-1})}},$size:function(n,e){return function(t){return d(t,n)&&t[n].length===e}},$elemMatch:function(n,e){var t=k(n,e);return function(e){return d(e,n)&&e[n].some(function(e){var r={};return r[n]=e,t.every(function(n){return n(r)})})}},$not:function(n,e){var t=k(n,e);return function(e){return!d(e,n)||t.every(function(n){return!n(e)})}}},v={$and:function(n,e){var t=e.map(x).reduce(i);return function(n){return t.every(function(e){return e(n)})}},$or:function(n,e){var t=e.map(x);return function(n){return t.some(function(e){return e.every(function(e){return e(n)})})}},$nor:function(n,e){var t=this.$and(n,e);return function(n){return!t(n)}}},h={$inc:function(n,e){return g(e,function(n,t){d(t,n)&&(t[n]+=e[n])})},$mul:function(n,e){return g(e,function(n,t){d(t,n)&&(t[n]*=e[n])})},$rename:function(n,e){return g(e,function(n,t){var r=t[n];delete t[n],t[e[n]]=r})},$set:function(n,e){return g(e,function(n,t){t[n]=e[n]})},$unset:function(n,e){return g(e,function(n,e){delete e[n]})},$min:function(n,e){return g(e,function(n,t){t[n]=Math.min(t[n],e[n])})},$max:function(n,e){return g(e,function(n,t){t[n]=Math.max(t[n],e[n])})},$addToSet:function(n,e){return g(e,function(n,t){f(t,n)?t[n].indexOf(e[n])===-1&&t[n].push(e[n]):t[n]=[e[n]]})},$pop:function(n,e){return g(e,function(n,t){f(t,n),1===e[n]?t[n].pop():e[n]===-1&&t[n].shift()})},$push:function(n,e){return g(e,function(n,t){f(t,n)?t[n].push(e[n]):t[n]=[e[n]]})},$pullAll:function(n,e){return g(e,function(n,t){f(t,n);var r=e[n];t[n]=t[n].filter(function(n){return r.indexOf(n)===-1})})},$pull:function(n,e){return g(e,function(n,t){f(t,n);var r=e[n],u=s(r);if(u)t[n]=t[n].filter(function(n){return n!==r});else{var o=k(n,r);t[n]=t[n].filter(function(e){var t={};return t[n]=e,!o.some(function(n){return n(t)})})}})},$slice:function(n,e){return g(e,function(n,t){f(t,n);var r=e[n];if(s(r))t[n]=p(t[n],r);else{var u=Object.keys(r);t[n]=t[n].map(function(n){return u.reduce(function(n,e){return n[e]=p(n[e],r[e]),n},n)})}})},$sort:function(n,e){return g(e,function(n,t){f(t,n);var r=e[n];if(s(r))t[n]=t[n].sort(function(n,e){return c(n,e,r)});else{var u=t[n].slice();t[n]=Object.keys(r).reduce(function(n,e){var t=r[e];return u.sort(function(n,r){var u=n[e],o=r[e];return c(u,o,t)})},t[n])}})}},b={query:Object.keys(y),queryLogical:Object.keys(v),update:Object.keys(h)},O=["upsert"],m=["$set","$addToSet","$push"],x=function(n){return Object.keys(n).map(function(e){return k(e,n[e])}).reduce(i)},k=function(n,e){return Object.keys(e).map(function(t){return L({key:n,type:t,value:e[t]})})},j=function(n,e){var t=e||Object.keys(n);return function(e){return t.every(function(t){return d(e,t)&&e[t]===n[t]})}},$=function(n,e){var t=e||Object.keys(n);return function(e){t.forEach(function(t){d(e,t)&&(e[t]=n[t])})}},g=function(n,e){var t=Object.keys(n);return function(n){t.forEach(function(t){e(t,n)})}},q=function(n,e){var t=Object.keys(n).filter(function(n){var e=d(y,n),t=d(v,n);return!(e||t)}),r=u(n,t),i=m.reduce(function(n,t){var r=e[t];return o(n,r)},{});return o(r,i)},C=function(n,e){var t=-1,r=-1,u=-1;return e.indexedKeys.forEach(function(n,e){n.unique?t=e:"number"==typeof n.value?r=e:n.plain&&(u=e)}),t>-1?e.indexedKeys[t]:r>-1?e.indexedKeys[r]:e.indexedKeys[u]},T=function(n){return n.queryOperators.advanced.map(function(n){return n.operators.map(function(e){return L({type:e,key:n.key,value:n.value[e]})})}).reduce(i)},w=function(n){return n.updateOperators.advanced.map(function(n){return L({type:n.key,key:null,value:n.value})})},K=function(n){var e=T(n);return function(n){return e.every(function(e){return e(n)})}},P=function(n){var e=w(n);return function(n){e.forEach(function(e){e(n)})}},E=function(n){return n.queryOperators.plain.map(function(n){return n.key})},A={primaryKey:function(n,e,t){var r=e.primaryKey.key,u=e.primaryKey.value,o=t.where(r).equals(u);if(e.queryOperators.plain.length>0){var i=j(n,E(e));o.and(i)}if(e.queryOperators.advanced.length>0){var c=K(e);o.and(c)}return o},indexedProp:function(n,e,t){var r,u=C(n,e);if(r=u&&u.plain?t.where(u.key).equals(u.value):t.toCollection(),e.queryOperators.plain.length>0){var o=j(n,E(e));r.and(o)}if(e.queryOperators.advanced.length>0){var i=K(e);r.and(i)}return r},fullScan:function(n,e,t){var r=t.toCollection();if(e.queryOperators.plain.length>0){var u=j(n,E(e));r.and(u)}if(e.queryOperators.advanced.length>0){var o=K(e);r.and(o)}return r}},S=function(n,e){var t=e.updateOperators.plain.length>0,r=e.updateOperators.advanced.length>0;return t&&r?l:t?$(n,e.keys):r?P(e):void 0},I=function(n,e){return{insertedCount:1,insertedId:e.id,ops:[e.item],result:{ok:1,n:1}}},_=function(n,e){var t=e&&e.isUpsert===!0,r=t?0:n,u=t?1:0;return{result:{ok:1,nModified:r},modifiedCount:r,upsertedCount:u,upsertedId:t?e.id:null}},D=function(n){return{result:{ok:1,n:n},deletedCount:n}},M=function(n,e,t){return new r.Promise(function(u){return n.update(e,t).then(function(u){if(0===u.modifiedCount){var o=q(e,t);return n.insert(o)}return r.Promise.resolve(u)}).then(function(n){var e=n;return"number"==typeof n.insertedId&&(e=_(1,{isUpsert:!0,id:n.insertedId})),u(e)})})},V=function(n,e,t){var r=H(t),u=S(t,r);return n.find(e).modify(u).then(function(n){return _(n,null)})},L=function(n){var e;return b.query.indexOf(n.type)>-1?e=y:b.queryLogical.indexOf(n.type)>-1?e=v:b.update.indexOf(n.type)>-1&&(e=h),e[n.type](n.key,n.value)},B=function(n,e,t){return e.reduce(t(n,e),{plain:[],advanced:[]})},N=function(n){return function(e,t){var r=n[t],u=s(r),o=b.queryLogical.indexOf(t)>-1;if(u)e.plain.push({key:t,value:r,plain:u});else if(o){var i={};i[t]=r,e.advanced.push({key:t,value:i,plain:u,operators:[t]})}else e.advanced.push({key:t,value:r,plain:u,operators:Object.keys(r).filter(function(n){return b.query.indexOf(n)>-1})});return e}},U=function(n){return function(e,t){var r=n[t],u=s(r);return u?e.plain.push({key:t,value:r,plain:u}):e.advanced.push({key:t,value:r,plain:u}),e}},W=function(n,e){return B(n,e,N)},z=function(n,e){return B(n,e,U)},Y=function(n,e){var t=e.primKey.keyPath,r=n[t],u=typeof r,o="number"===u||"string"===u;return o?{key:t,value:r}:{key:!1}},F=function(n,e,t){return t.indexes.filter(function(n){return e.indexOf(n.keyPath)>-1}).map(function(e){var t=e.keyPath;return{key:t,value:n[t],unique:e.unique,plain:s(n[t])}})},G=function(n,e){var t=Object.keys(n);return{keys:t,queryOperators:W(n,t),primaryKey:Y(n,e),indexedKeys:F(n,t,e)}},H=function(n){var e=Object.keys(n);return{keys:e,updateOperators:z(n,e)}},J=function(n){return a(n)?{}:u(n,O)},Q=function(n,e){var t,r=G(n,e);return t=r.primaryKey.key?"primaryKey":r.indexedKeys.length>0?"indexedProp":"fullScan",{queryAnalysis:r,execute:A[t]}},R=function(n,e,t,r){var u=r.upsert===!0?M:V;return u(n,e,t)},X=function(n,e){if(a(e))return n.toCollection();var t=Q(e,n.schema);return t.execute(e,t.queryAnalysis,n)},Z=function(n,e){var t=n.schema.primKey.keyPath;return n.add(e).then(function(n){var r=u(e,Object.keys(e));return r[t]=n,I(1,{item:e,id:n})})},nn=function(n,e){return X(n,e).delete().then(D)},en=function(n){return n.toCollection().delete().then(D)};r.addons.push(function(n){n.Collection.prototype.sort=function(n){return this._sortValue=n,this},n.Collection.prototype.toArray=function(n){return function(e){if(this._sortValue){var t=this._sortValue,r=Object.keys(t)[0],u=t[r];return this._sortValue=null,u==-1?this.reverse().sortBy(r,e):this.sortBy(r,e)}return n.call(this,e)}}(n.Collection.prototype.toArray),n.Table.prototype.merge=function(n){var e=this,t=n.map(function(n){return n.id}),u=e.remove({id:{$nin:t}});return r.Promise.all([u].concat(n.map(function(n,t){return e.findOne({id:n.id}).then(function(t){return t?e.update({id:n.id},n):e.insert(n)})})))},r.prototype.collection=function(e){return n.table(e)},n.Table.prototype.count=function(n){var e=a(n),t=e?this.toCollection():X(this,n);return t.count()},n.Table.prototype.find=function(n){return X(this,n)},n.Table.prototype.findOne=function(n){return X(this,n).first()},n.Table.prototype.insert=function(n){return Z(this,n)},n.Table.prototype.insertOne=n.Table.prototype.insert,n.Table.prototype.remove=function(n){return nn(this,n)},n.Table.prototype.drop=function(){return en(this)};var e;e=n.WriteableTable?n.WriteableTable:n.Table,e.prototype.update=function n(e,n,t){var r=J(t);return R(this,e,n,r)}})},function(n,e){"use strict";n.exports=function(n,e){return n.hasOwnProperty(e)}},function(n,e,t){"use strict";function r(n,e){return n.concat(e)}var u=t(3);n.exports=u(r)},function(n,e){"use strict";function t(n,e){var t=function(){return arguments.length>1?n.call(e,arguments[0],arguments[1]):n.bind(e,arguments[0])};return t.uncurry=function(){return n},t}n.exports=t},function(n,e){"use strict";function t(n){if(null===n||void 0===n)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(n)}function r(){try{if(!Object.assign)return!1;var n=new String("abc");if(n[5]="de","5"===Object.getOwnPropertyNames(n)[0])return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var r=Object.getOwnPropertyNames(e).map(function(n){return e[n]});if("0123456789"!==r.join(""))return!1;var u={};return"abcdefghijklmnopqrst".split("").forEach(function(n){u[n]=n}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},u)).join("")}catch(n){return!1}}var u=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;n.exports=r()?Object.assign:function(n,e){for(var r,c,f=t(n),a=1;a<arguments.length;a++){r=Object(arguments[a]);for(var s in r)o.call(r,s)&&(f[s]=r[s]);if(u){c=u(r);for(var p=0;p<c.length;p++)i.call(r,c[p])&&(f[c[p]]=r[c[p]])}}return f}},function(n,e){n.exports=function(n,e){return n=n||{},"string"==typeof e&&(e=e.split(/ +/)),e.reduce(function(e,t){return null==n[t]?e:(e[t]=n[t],e)},{})}},function(n,e){"use strict";n.exports=function(n,e){return e>=0?n.slice(0,e):n.slice(e)}},function(n,e,t){"use strict";var r=t(1);n.exports=function(n,e){var t=r(n,e),u=Array.isArray(n[e]);if(t&&!u)throw new Error("You can't use array update operator on non-array field");return t}},function(n,e){n.exports=function(n){var e="object"==typeof n&&null!==n,t=!(e&&n);return t||0===Object.keys(n).length}},function(n,e){"use strict";n.exports=function(n){var e=typeof n;return"number"===e||"string"===e||"boolean"===e}},function(n,e){n.exports=function(){}},function(n,e){"use strict";n.exports=function(n,e,t){return 1===t?n>e:n<e}},function(e,t){e.exports=n}])});